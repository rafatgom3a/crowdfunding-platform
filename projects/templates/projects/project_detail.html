{% extends "base.html" %}
{% block content %}
<div class="container my-4">
  <h1 class="mb-3">{{ object.title }}</h1>
  
  <p class="lead">{{ object.description }}</p>

  <div class="row mb-3">
    <div class="col-md-6">
      <ul class="list-group">
        <li class="list-group-item"><strong>Category:</strong> {{ object.category.name }}</li>
        <li class="list-group-item">
          <strong>Tags:</strong>
          {% for tag in object.tags.all %}
            <span class="badge bg-secondary me-1">{{ tag.name }}</span>
          {% empty %}
            <span>No tags</span>
          {% endfor %}
        </li>
        <li class="list-group-item"><strong>Target Amount:</strong> ${{ object.target_amount }}</li>
        <li class="list-group-item"><strong>Current Amount:</strong> ${{ object.current_amount }}</li>
      </ul>
    </div>

    <div class="col-md-6">
      <ul class="list-group">
        <li class="list-group-item"><strong>Start Time:</strong> {{ object.start_time|date:"M d, Y H:i" }}</li>
        <li class="list-group-item"><strong>End Time:</strong> {{ object.end_time|date:"M d, Y H:i" }}</li>
        <li class="list-group-item">
          <strong>Average Rating:</strong> {{ object.average_rating }} <i class="bi bi-star-fill text-warning"></i>
        </li>
      </ul>
    </div>
  </div>

  <div class="mb-4">
    <h3>Images</h3>
    <div class="d-flex flex-wrap gap-3">
      {% for image in object.project_images.all %}
        <img src="{{ image.image.url }}" alt="Project Image {{ forloop.counter }}" class="img-thumbnail" style="width: 150px; height: auto;">
      {% empty %}
        <p>No images available.</p>
      {% endfor %}
    </div>
  </div>

  {% if user.is_authenticated %}
    {% if user == object.created_by or user.is_staff %}
      <div class="mb-4">
        <a href="{% url 'projects:update' object.id %}" class="btn btn-primary me-2">Edit</a>
        <a href="{% url 'projects:delete' object.id %}" class="btn btn-danger">Delete</a>
      </div>
    {% else %}
      <div class="mb-4">
        <a href="{% url 'donations:donate' object.id %}" class="btn btn-success">Donate</a>
      </div>
      <div class="container mt-4">
        <h3>Add Comment to {{ object.title }}</h3>
        <form method="post" action="{% url 'comments:add_comment' project.id %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
    </div>
    {% endif %}
  {% endif %}

  <div class="container mt-4">
    <h3>Comments</h3>
    <ul class="list-group">
      {% for comment in object.comments.all %}
        <li class="list-group-item">
          <strong>{{ comment.user.first_name }}</strong> ({{ comment.created_at|date:"M d, Y H:i" }}):
          <p>{{ comment.content }}</p>
          {% if user.is_authenticated and user == comment.user %}
            <a href="{% url 'comments:delete_comment' comment.id %}" class="btn btn-danger btn-sm">Delete</a>
          {% endif %}
        </li>
      {% empty %}
        <li class="list-group-item">No comments yet.</li>
      {% endfor %}
    </ul>
  </div>
  <div>
    <h3>Similar Projects</h3>
    <ul class="list-group">
      {% for proj in similar_projects %}
        <li class="list-group-item">
          <a href="{% url 'projects:detail' proj.id %}">{{ proj.title }}</a>
        </li>
      {% empty %}
        <li class="list-group-item">No similar projects found.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

